{% extends "location/header.html" %}

{% block content %}

<script type="text/javascript">
getLocation()
disable_aniboy()


function disable_aniboy(){
	var ye = document.getElementById('lastbolt');
	ye.style.webkitAnimationPlayState = 'paused';
	var y = document.getElementById('boltrow1');
	y.style.webkitAnimationPlayState = 'running';
	var yaa = document.getElementById('boltrow2');
	yaa.style.webkitAnimationPlayState = 'paused';
	var yb = document.getElementById('boltrow3');
	yb.style.webkitAnimationPlayState = 'paused';

	var yc = document.getElementById('boltrow4');
	yc.style.webkitAnimationPlayState = 'paused';

}

//log


function __log(e, data) {
    log.innerHTML += "\n" + e + " " + (data || '');
  }



//soundboy_two JS file header validation

function soundboy_two(){
	// var filesize=document.getElementById('soundid').files[0].size;
	var control = document.getElementById("soundid").files;
	var xa = document.getElementById("allow");
	var audtype = 'audio/mpeg'
    
    if (control.size > 7418203) {
    	xa.setAttribute("disabled", true);
    	document.getElementById('update').innerHTML='Sound file too big. Make sure the file is less than 4 GB.'
    }
    else{
	   	xa.removeAttribute("disabled");
    	document.getElementById('update').innerHTML=''
    	for (var i = 0; i < control.length; i++) {
        	console.log("Filename: " + control[i].name);
        	console.log("Type: " + control[i].type);
        	console.log("Size: " + control[i].size + " bytes");

    }
}
}

//xtra client validation stuff//
// function get_header(){
// 	var control = document.getElementById("soundid").files;
// 	var xa = document.getElementById("allow");
//     for (var i = 0; i < control.length; i++) {
//         	console.log("Filename: " + control[i].name);
//         	console.log("Type: " + control[i].type);
// 		    console.log("Size: " + control[i].size + " bytes");}



// 	var files = control.files
// 	var blob = files[i]; // See step 1 above

// 	var fileReader = new FileReader();
// 	fileReader.onloadend = function(e) {
//   	var arr = (new Uint8Array(e.target.result)).subarray(0, 4);
//   	var header = "";
//   	for(var i = 0; i < arr.length; i++) {
//      header += arr[i].toString(16);
//   	}
//   	console.log(header);

//   // Check the file signature against known types
// };
// fileReader.readAsArrayBuffer(blob);


// switch (header) {
//     case "89504e47":
//         type = "image/png";
//         break;
//     case "47494638":
//         type = "image/gif";
//         break;
//     case "ffd8ffe0":
//     case "ffd8ffe1":
//     case "ffd8ffe2":
//         type = "image/jpeg";
//         break;
//     default:
//         type = "unknown"; // Or you can use the blob.type as fallback
//         break;
// }



//

//soundboy


// function soundboy(){
// 	var filesize=document.getElementById('soundid').files[0].size;
//     __log(filesize); 
//     if (filesize > 7418203) {
//     	document.getElementById('update').innerHTML='Sound file too big. Make sure the file is less than 4 GB.'
//     }   
//     else{
//     	var xax = document.getElementById("allow");
//     	xax.removeAttribute("disabled");
//     }




//get location

function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);

    } else { 
        x.innerHTML = "Geolocation is not supported by this browser.";
    }
}

function showPosition(position) {

    document.getElementById('latitude').value = position.coords.longitude;
    document.getElementById('longitude').value = position.coords.latitude;
    
}




</script>




<div class= 'border'>
<div class= 'center_div'>
<div class="row vertical-center-row">



<!--audio recorder script--> 

<!-- <script type="text/javascript">
 function __log(e, data) {
    log.innerHTML += "\n" + e + " " + (data || '');
  }

  var audio_context;
  var recorder;

  function startUserMedia(stream) {
    var input = audio_context.createMediaStreamSource(stream);
    __log('Media stream created.');

    // Uncomment if you want the audio to feedback directly
    //input.connect(audio_context.destination);
    //__log('Input connected to audio context destination.');
    
    recorder = new Recorder(input);
    __log('Recorder initialised.');
  }

  function startRecording(button) {
    recorder && recorder.record();
    button.disabled = true;
    button.nextElementSibling.disabled = false;
    __log('Recording...');
  }

  function stopRecording(button) {
    recorder && recorder.stop();
    button.disabled = true;
    button.previousElementSibling.disabled = false;
    __log('Stopped recording.');
    
    // create WAV download link using audio data blob
    createDownloadLink();
    
    recorder.clear();
  }

  function createDownloadLink() {
    recorder && recorder.exportWAV(function(blob) {
      var url = URL.createObjectURL(blob);
      var li = document.createElement('li');
      var au = document.createElement('audio');
      var hf = document.createElement('a');
      // document.getElementById('longitude').value = URL.createObjectURL(blob);
      
      au.controls = true;
      au.src = url;
      hf.href = url;
      hf.download = new Date().toISOString() + '.wav';
      hf.innerHTML = hf.download;
      li.appendChild(au);
      li.appendChild(hf);
      recordingslist.appendChild(li);
    });
  }

  window.onload = function init() {
    try {
      // webkit shim
      window.AudioContext = window.AudioContext || window.webkitAudioContext;
      navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mediaDevices.getUserMedia;
      window.URL = window.URL || window.webkitURL;
      
      audio_context = new AudioContext;
      __log('Audio context set up.');
      __log('navigator.mediaDevices.getUserMedia' + (navigator.getUserMedia ? 'available.' : 'not present!'));
    } catch (e) {
      alert('No web audio support in this browser!');
    }
    
    navigator.getUserMedia({audio: true}, startUserMedia, function(e) {
      __log('No live audio input: ' + e);
    });
 };</script>  -->  




<!--post form-->

<form method='POST' action='' enctype='multipart/form-data'>{% csrf_token %}


<!-- Form Errors -->


   {% if form.errors %}
        {% for field in form %}
            {% for error in field.errors %}
                <p style="color: #ff8370;">
                    {{ error|escape }}
                </p>
            {% endfor %}
        {% endfor %}
        {% for error in form.non_field_errors %}
            <p style="color: #ff8370;">
                {{ error|escape }}
            </p>
        {% endfor %}
    {% endif %}







	<p id='update' style="color: #ff8370;"></p>
	

		<input  id='longitude'  type= 'number' step='any' value='0' name='latitude' style="display:none" required>
		<input  id='latitude'  type= 'number' step='any' value='0' name='longitude' style="display:none" required>

	
		<input  id='usersave'  type= 'text' name='usersave' value='{{ request.user }}' style="display:none" required>


	<p>title:</p>
	{{form.title}}</br></br>
	<p>upload:</p>
		<!-- {{form.sound}}</br></br> -->
		<input id= 'soundid' type="file"  name="sound" accept='audio/*' onchange="soundboy_two()"></br></br>
		<input id= 'allow' class="btn btn-success" type= 'submit' style="color:#34373a; font-size: 25px; width: 100%" value="post sound" disabled />
</form>



<!--   <p>Log</p>
  <pre id="log"></pre>  -->

<!-- AUDIO RECORD-->

<!-- </br>
</br>
  <button onclick="startRecording(this);">record</button>
  <button onclick="stopRecording(this);" disabled>stop</button>
  
  <p>Recordings</p>
  <ul id="recordingslist"></ul>
  
  <p>Log</p>
  <pre id="log"></pre>  -->


</div>
</div>
</div>




{% endblock %}
