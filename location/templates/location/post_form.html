{% extends "location/header.html" %}

{% block content %}

<script type="text/javascript">
getLocation()

function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);

    } else { 
        x.innerHTML = "Geolocation is not supported by this browser.";
    }
}

function showPosition(position) {

    document.getElementById('latitude').value = position.coords.longitude;
    document.getElementById('longitude').value = position.coords.latitude;
    
}

</script>




<div class= 'border'>
<div class= 'center_div'>
<div class="row vertical-center-row">



<!--audio script--> 

<!-- <script type="text/javascript">
 function __log(e, data) {
    log.innerHTML += "\n" + e + " " + (data || '');
  }

  var audio_context;
  var recorder;

  function startUserMedia(stream) {
    var input = audio_context.createMediaStreamSource(stream);
    __log('Media stream created.');

    // Uncomment if you want the audio to feedback directly
    //input.connect(audio_context.destination);
    //__log('Input connected to audio context destination.');
    
    recorder = new Recorder(input);
    __log('Recorder initialised.');
  }

  function startRecording(button) {
    recorder && recorder.record();
    button.disabled = true;
    button.nextElementSibling.disabled = false;
    __log('Recording...');
  }

  function stopRecording(button) {
    recorder && recorder.stop();
    button.disabled = true;
    button.previousElementSibling.disabled = false;
    __log('Stopped recording.');
    
    // create WAV download link using audio data blob
    createDownloadLink();
    
    recorder.clear();
  }

  function createDownloadLink() {
    recorder && recorder.exportWAV(function(blob) {
      var url = URL.createObjectURL(blob);
      var li = document.createElement('li');
      var au = document.createElement('audio');
      var hf = document.createElement('a');
      // document.getElementById('longitude').value = URL.createObjectURL(blob);
      
      au.controls = true;
      au.src = url;
      hf.href = url;
      hf.download = new Date().toISOString() + '.wav';
      hf.innerHTML = hf.download;
      li.appendChild(au);
      li.appendChild(hf);
      recordingslist.appendChild(li);
    });
  }

  window.onload = function init() {
    try {
      // webkit shim
      window.AudioContext = window.AudioContext || window.webkitAudioContext;
      navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mediaDevices.getUserMedia;
      window.URL = window.URL || window.webkitURL;
      
      audio_context = new AudioContext;
      __log('Audio context set up.');
      __log('navigator.mediaDevices.getUserMedia' + (navigator.getUserMedia ? 'available.' : 'not present!'));
    } catch (e) {
      alert('No web audio support in this browser!');
    }
    
    navigator.getUserMedia({audio: true}, startUserMedia, function(e) {
      __log('No live audio input: ' + e);
    });
 };</script>  -->    


<!--  grab location button and post form-->

<form method='POST' action='' enctype='multipart/form-data'>{% csrf_token %}
<!-- 	<button class="btn btn-success" onclick="getLocation()"  style="color:#34373a; font-size: 20px; width: 100%" >get coordinates</button></br></br> -->
	<p id='update'></p>
	<!-- <p>latitude & longitude:</p> -->

	<input  id='longitude'  type= 'number' step='any' value='0' name='latitude' style="display:none" required>
	<input  id='latitude'  type= 'number' step='any' value='0' name='longitude' style="display:none" required>

	<p>title:</p>
	{{form.title}}</br></br>
	<p>upload:</p>
	<!-- {{form.sound}}</br></br> -->
	<input type="file"  name="sound" accept='audio/*' required></br></br>
	<input class="btn btn-success" type= 'submit' style="color:#34373a; font-size: 25px; width: 100%" value="post sound" />
</form>

<!-- AUDIO RECORD-->

<!-- </br>
</br>
  <button onclick="startRecording(this);">record</button>
  <button onclick="stopRecording(this);" disabled>stop</button>
  
  <p>Recordings</p>
  <ul id="recordingslist"></ul>
  
  <p>Log</p>
  <pre id="log"></pre>  -->


</div>
</div>
</div>




{% endblock %}
